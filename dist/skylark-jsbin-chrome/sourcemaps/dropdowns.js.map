{"version":3,"sources":["dropdowns.js"],"names":["define","$","jsbin","chrome","analytics","menuDown","opendropdown","el","nofocus","menu","dropdownOpen","closest","addClass","trigger","openMenu","hash","substring","input","find","length","mobile","focus","setTimeout","select","closedropdown","dropdownButtons","removeClass","f","panels","focused","editor","mousedown","e","$dropdownLinks","this","preventDefault","mouseup","click","closeMenu","attr","ignoreUp","$body","bind","event","target","fromClick","nodeName","selectMenu","getAttribute","href","hostname","window","location","triggerHandler","open","mouseover","dropdowns"],"mappings":";;;;;;;AAAAA,QACE,iBACC,UACA,WACA,eACD,SAAUC,EAAEC,EAAMC,EAAOC,GAGzB,IAGIC,GAAW,EAEf,SAASC,EAAaC,EAAIC,GACxB,IAAIC,EACJ,IAAKP,EAAMQ,aAAc,CACvBD,EAAOR,EAAEM,GAAII,QAAQ,SAASC,SAAS,QAAQC,QAAQ,QAEvDT,EAAUU,SAASP,EAAGQ,KAAKC,UAAU,IACrC,IAAIC,EAAQR,EAAKS,KAAK,uBAElBD,EAAME,SAAWjB,EAAMkB,SACzBH,EAAMI,QACNC,WAAW,WACTL,EAAM,GAAGM,UACR,IAELrB,EAAMQ,aAAeH,GAIzB,SAASiB,IAEP,GADAnB,GAAW,EACPH,EAAMQ,aAAc,CACtBe,EAAgBd,QAAQ,SAASe,YAAY,QAAQb,QAAQ,SAE7DX,EAAMQ,cAAe,GACX,EACV,IAAIiB,EAAIzB,EAAM0B,OAAOC,QACjBF,IAAMzB,EAAMkB,SACdO,EAAEN,QACEM,EAAEG,QACJH,EAAEG,OAAOT,UAMjB,IAAII,EAAkBxB,EAAE,kCAAkC8B,UAAU,SAAUC,GAU5E,OATAC,EAAeP,YAAY,SACvBxB,EAAMQ,cAAgBR,EAAMQ,eAAiBwB,MAC/CV,IAEGtB,EAAMQ,eACTL,GAAW,EACXC,EAAa4B,OAEfF,EAAEG,kBACK,IACNC,QAAQ,WACT,GAAI/B,EAAU,OAAO,IACpBgC,MAAM,WAKP,OAJKhC,IACHD,EAAUkC,UAAUJ,KAAKnB,KAAKC,UAAU,IACxCQ,KAEEnB,GACFJ,EAAEiC,KAAKnB,MAAMwB,KAAK,WAAY,GAC9BlC,GAAW,EACJH,EAAMkB,SAGff,GAAW,EAEXJ,EAAEiC,KAAKnB,MAAMwB,KAAK,YAAa,IACxB,KAGTtC,EAAE,eAAeoC,MAAM,WACrBnC,EAAMQ,cAAe,IAGvB,IAAI8B,GAAW,EACftC,EAAMuC,MAAMC,KAAK,YAAa,SAAUC,GAClCzC,EAAMQ,cACJT,EAAE0C,EAAMC,QAAQjC,QAAQ,SAASQ,SACnCqB,GAAW,KAGdE,KAAK,gBAAiB,SAAUC,GACjC,GAAIzC,EAAMQ,eAAiB8B,IACpBvC,EAAE0C,EAAMC,QAAQjC,QAAQ,SAASQ,OAEpC,OADAK,KACO,EAGXgB,GAAW,IAGb,IAAIK,GAAY,EACZZ,EAAiBhC,EAAE,0CAA0CmC,QAAQ,SAAUJ,GACvD,UAAtBA,EAAEY,OAAOE,WAIbxB,WAAWE,EAAe,GAC1BpB,EAAU2C,WAAWb,KAAKc,aAAa,eAAiBd,KAAKnB,KAAKC,UAAU,IAAMkB,KAAKe,MAClFJ,IACCX,KAAKgB,WAAaC,OAAOC,SAASF,UACI,IAApCjD,EAAEiC,MAAMmB,eAAe,WACzBF,OAAOC,SAAWlB,KAAKe,MAGrBf,KAAKc,aAAa,UACpBG,OAAOG,KAAKpB,KAAKe,MAEjBE,OAAOC,SAAWlB,KAAKe,MAI7BJ,GAAY,KACXU,UAAU,WACXtB,EAAeP,YAAY,SAC3BzB,EAAEiC,MAAMtB,SAAS,WAChBmB,UAAU,SAAUC,GACK,UAAtBA,EAAEY,OAAOE,WAGbD,GAAY,KAId,OAAO1C,EAAOqD,WACZlD,aAAAA,EACAkB,cAAAA","file":"../dropdowns.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"./jsbin\",\r\n   \"./chrome\",\r\n   \"./analytics\"\r\n],function ($,jsbin,chrome,analytics) {\r\n  //moved from chrome/navigation.js\r\n\r\n  var \r\n      //dropdownOpen = false,\r\n      onhover = false,\r\n      menuDown = false;\r\n\r\n  function opendropdown(el, nofocus) {\r\n    var menu;\r\n    if (!jsbin.dropdownOpen) {\r\n      menu = $(el).closest('.menu').addClass('open').trigger('open');\r\n      // $body.addClass('menuinfo');\r\n      analytics.openMenu(el.hash.substring(1));\r\n      var input = menu.find(':text:visible:first');\r\n\r\n      if (input.length && !jsbin.mobile) {\r\n        input.focus();\r\n        setTimeout(function () {\r\n          input[0].select();\r\n        }, 0);\r\n      }\r\n      jsbin.dropdownOpen = el;\r\n    }\r\n  }\r\n\r\n  function closedropdown() {\r\n    menuDown = false;\r\n    if (jsbin.dropdownOpen) {\r\n      dropdownButtons.closest('.menu').removeClass('open').trigger('close');\r\n      // $body.removeClass('menuinfo');\r\n      jsbin.dropdownOpen = false;\r\n      onhover = false;\r\n      var f = jsbin.panels.focused; // TODO\r\n      if (f && !jsbin.mobile) {\r\n        f.focus();\r\n        if (f.editor) {\r\n          f.editor.focus();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  var dropdownButtons = $('.button-dropdown, .button-open').mousedown(function (e) {\r\n    $dropdownLinks.removeClass('hover');\r\n    if (jsbin.dropdownOpen && jsbin.dropdownOpen !== this) {\r\n      closedropdown();\r\n    }\r\n    if (!jsbin.dropdownOpen) {\r\n      menuDown = true;\r\n      opendropdown(this);\r\n    }\r\n    e.preventDefault();\r\n    return false;\r\n  }).mouseup(function () {\r\n    if (menuDown) return false;\r\n  }).click(function () {\r\n    if (!menuDown) {\r\n      analytics.closeMenu(this.hash.substring(1));\r\n      closedropdown();\r\n    }\r\n    if (menuDown) {\r\n      $(this.hash).attr('tabindex', 0);\r\n      menuDown = false;\r\n      return jsbin.mobile;\r\n    }\r\n\r\n    menuDown = false;\r\n\r\n    $(this.hash).attr('tabindex', -1);\r\n    return false;\r\n  });\r\n\r\n  $('#actionmenu').click(function () {\r\n    jsbin.dropdownOpen = true;\r\n  });\r\n\r\n  var ignoreUp = false;\r\n  jsbin.$body.bind('mousedown', function (event) {\r\n    if (jsbin.dropdownOpen) {\r\n      if ($(event.target).closest('.menu').length) {\r\n        ignoreUp = true;\r\n      }\r\n    }\r\n  }).bind('click mouseup', function (event) {\r\n    if (jsbin.dropdownOpen && !ignoreUp) {\r\n      if (!$(event.target).closest('.menu').length) {\r\n        closedropdown();\r\n        return false;\r\n      }\r\n    }\r\n    ignoreUp = false;\r\n  });\r\n\r\n  var fromClick = false;\r\n  var $dropdownLinks = $('.dropdownmenu a, .dropdownmenu .button').mouseup(function (e) {\r\n    if (e.target.nodeName === 'INPUT') {\r\n      return;\r\n    }\r\n\r\n    setTimeout(closedropdown, 0);\r\n    analytics.selectMenu(this.getAttribute('data-label') || this.hash.substring(1) || this.href);\r\n    if (!fromClick) {\r\n      if (this.hostname === window.location.hostname) {\r\n        if ($(this).triggerHandler('click') !== false) {\r\n          window.location = this.href;\r\n        }\r\n      } else {\r\n        if (this.getAttribute('target')) {\r\n          window.open(this.href);\r\n        } else {\r\n          window.location = this.href;\r\n        }\r\n      }\r\n    }\r\n    fromClick = false;\r\n  }).mouseover(function () {\r\n    $dropdownLinks.removeClass('hover');\r\n    $(this).addClass('hover');\r\n  }).mousedown(function (e) {\r\n    if (e.target.nodeName === 'INPUT') {\r\n      return;\r\n    }\r\n    fromClick = true;\r\n  });\r\n\r\n\r\n  return chrome.dropdowns = {\r\n    opendropdown,\r\n    closedropdown\r\n  }\r\n});"]}